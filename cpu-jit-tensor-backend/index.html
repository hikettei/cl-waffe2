<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>cl-waffe2/backends.jit.cpu - cl-waffe2 Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "cl-waffe2/backends.jit.cpu";
        var mkdocs_page_input_path = "cpu-jit-tensor-backend.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> cl-waffe2 Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Install</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Learn More</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../utils/">cl-waffe2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../nodes/">cl-waffe2/vm.nodes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../generic-tensor/">cl-waffe2/vm.generic-tensor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../vm/">cl-waffe2/vm</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../base-impl/">[Functions] cl-waffe2/base-impl</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../base-impl-nodes/">[Nodes] cl-waffe2/base-impl</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../distributions/">cl-waffe2/distributions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../nn/">cl-waffe2/nn</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../optimizer/">cl-waffe2/optimizers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lisp-tensor-backend/">cl-waffe2/backends.lisp</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cpu-tensor-backend/">cl-waffe2/backends.cpu</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">cl-waffe2/backends.jit.cpu</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#parameter-default-c-compiler">[parameter] *default-c-compiler*</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parameter-compiler-flags">[parameter] *compiler-flags*</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parameter-viz-compiled-code">[parameter] *viz-compiled-code*</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#abstracttensor-jitcputensor">[AbstractTensor] JITCPUTensor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#function-cpujit-set-config">[function] cpujit-set-config</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#inputs">Inputs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#macro-with-cpu-jit">[macro] with-cpu-jit</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">cl-waffe2 Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>cl-waffe2/backends.jit.cpu</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="backend-cl-waffe2backendsjitcpu">[backend] :cl-waffe2/backends.jit.cpu</h1>
<p>Those backends without JIT, relies on <code>do-compiled-loop</code> or <code>call-with-view</code> to calculate only part of matrices: complicated offsets and permution (i.e: <code>!view</code> and <code>!permute</code>). However, under certain circumstances this can be difficult to parallelise by simply calling a CFFI function; and this backend is intended to solve the problem.</p>
<p>This package provides a <code>JITCPUTensor</code> backend which works by jit-compiling whole code to vectorized C, and is only for the purpose of optimising memory layout, so currently only four arithmetic operations and copying are implemented. (OpFusion is remained to be implemented; but it is definitely possible to fuse several ops)</p>
<p>Optimise the memory layout by enclosing the code you want to optimise the layout in:</p>
<pre><code class="language-lisp">(with-cpu-jit (CPUTensor LispTensor)
    ;; body
    )
</code></pre>
<p>Tips: Use the <code>proceed-bench</code> function to know the bottleneck; if <code>MoveTensorNode</code> combined with <code>PermuteNode</code> is slow compared to other nodes, the memory layout is remained to be optimized for example.</p>
<h2 id="parameter-default-c-compiler">[parameter] <code>*default-c-compiler*</code></h2>
<p>Specify the command to compile the generated c codes. In default, "gcc".</p>
<h2 id="parameter-compiler-flags">[parameter] <code>*compiler-flags*</code></h2>
<p>In default, <code>*compielr-flags*</code> = <code>'("-fPIC" "-O3" "-march=native")</code></p>
<h2 id="parameter-viz-compiled-code">[parameter] <code>*viz-compiled-code*</code></h2>
<p>Set t to display the compiled c code to terminal. In default, <code>nil</code></p>
<h2 id="abstracttensor-jitcputensor">[AbstractTensor] JITCPUTensor</h2>
<pre><code class="language-lisp">(with-devices (JITCPUTensor CPUTensor LispTensor)
    ;; Your code follows...
    )
</code></pre>
<h2 id="function-cpujit-set-config">[function] cpujit-set-config</h2>
<pre><code class="language-lisp">(cpujit-set-config (&amp;key
                      (compiler &quot;gcc&quot;)
              (viz-compiled-code nil)
                      (openmp nil)
                  (flags '(&quot;-fPIC&quot; &quot;-O3&quot; &quot;-march=native&quot;))))
</code></pre>
<p>Declares configurations about JITCPUTensor. </p>
<h3 id="inputs">Inputs</h3>
<p><code>compiler[string]</code> a compiler to use. in default set to gcc</p>
<p><code>viz-compiled-code[boolean]</code> Set t to display generated C codes.</p>
<p><code>openmp[boolean]</code> Set t to use OpenMP.</p>
<p><code>flags[list]</code> additional compiler flags.</p>
<h2 id="macro-with-cpu-jit">[macro] with-cpu-jit</h2>
<pre><code class="language-lisp">(with-cpu-jit (&amp;rest more-devices) &amp;body body)
</code></pre>
<p>Under this macro, two backends (<code>JITCPUTensor</code> and <code>JITCPUScalarTensor</code>) are installed at the top of the priority list.</p>
<p>That is:</p>
<pre><code class="language-lisp">`(with-devices (JITCPUTensor ,@more-devices)
     ,@body)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../cpu-tensor-backend/" class="btn btn-neutral float-left" title="cl-waffe2/backends.cpu"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../cpu-tensor-backend/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
